/*
 * Copyright (C) 2025 The Gravitee team (http://gravitee.io)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

@use 'sass:map';

// Get the css variable value from the token mapping
@function slot($token-name, $gmd-tokens) {
  $tokens: map.get($gmd-tokens, tokens);
  $token-data: map.get($tokens, $token-name);
  $namespace: map.get($gmd-tokens, namespace);
  @if $token-data {
    $css-var: -calculate-css-var($namespace, $token-name);

    @return var(#{$css-var}, #{$token-data});
  }
  @error 'Token #{$token-name} not found in gmd tokens';
}

/**
*  Apply token overrides to the component
*/
@mixin apply-token-overrides($token-values, $overrides: ()) {
  $token-mapping: map.get($token-values, tokens);

  @include -validate-token-overrides($token-mapping, $overrides);

  $merged-overrides: -merge-token-overrides($token-mapping, $overrides);
  $namespace: map.get($token-values, namespace);

  @each $key, $value in $merged-overrides {
    $css-var: -calculate-css-var($namespace, $key);

    #{$css-var}: #{$value};
  }
}

@function -calculate-css-var($prefix, $token-name) {
  @return '--gmd-#{$prefix}-#{$token-name}';
}

@function -merge-token-overrides($default-tokens, $overrides) {
  @return map.deep-merge($default-tokens, $overrides);
}

@mixin -validate-token-overrides($default-values, $overrides) {
  @each $token, $value in $overrides {
    @if not map.has-key($default-values, $token) {
      @error 'Token "#{$token}" does not exist in the token mapping. Available tokens: #{map.keys($default-values)}';
    }
  }
}
