<!--

    Copyright (C) 2015 The Gravitee team (http://gravitee.io)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<h2 mat-dialog-title>Webhook Logs reporting settings</h2>

@if (isLoading) {
  <mat-dialog-content>
    <p>Loading settings...</p>
  </mat-dialog-content>
} @else {
  <form [formGroup]="form">
    <mat-dialog-content>
      <div class="settings-content__header">
        <p class="settings-content__description">
          This enables reporting of your data inside your analytics databases i.e. ElasticSearch or OpenSearch.
        </p>
        <gio-form-slide-toggle class="settings-content__toggle">
          <gio-form-label>{{ form.value.enabled ? 'Enabled' : 'Disabled' }}</gio-form-label>
          <mat-slide-toggle gioFormSlideToggle formControlName="enabled" color="primary"></mat-slide-toggle>
        </gio-form-slide-toggle>
      </div>

      <gio-banner-info class="logging-banner">
        <span> Opt for logging checkboxes carefully, this requires extra storage and may affect API performance. </span>
      </gio-banner-info>

      <div class="settings__form-control">
        <div class="settings__form-control__title">Content data</div>
        <div class="settings__form-control__toggles">
          <gio-form-slide-toggle>
            <gio-form-label>Request body</gio-form-label>
            <mat-slide-toggle gioFormSlideToggle formControlName="requestBody"></mat-slide-toggle>
          </gio-form-slide-toggle>
          <gio-form-slide-toggle>
            <gio-form-label>Request headers</gio-form-label>
            <mat-slide-toggle gioFormSlideToggle formControlName="requestHeaders"></mat-slide-toggle>
          </gio-form-slide-toggle>
          <gio-form-slide-toggle>
            <gio-form-label>Response body</gio-form-label>
            <mat-slide-toggle gioFormSlideToggle formControlName="responseBody"></mat-slide-toggle>
          </gio-form-slide-toggle>
          <gio-form-slide-toggle>
            <gio-form-label>Response headers</gio-form-label>
            <mat-slide-toggle gioFormSlideToggle formControlName="responseHeaders"></mat-slide-toggle>
          </gio-form-slide-toggle>
        </div>
      </div>

      <div class="settings__form-control sampling-summary">
        <div class="settings__form-control__title">Message sampling</div>
        <p class="sampling-summary__description">
          This is the current message sampling configuration for this API – Edit it in
          <a [routerLink]="reporterSettingsLink">Deployment › Reporter Settings</a>.
          <br />
          Note: the sampling mode affects all API messages, not only webhook messages.
        </p>
        <div class="sampling-summary__card sampling-summary__card--row">
          <span class="sampling-summary__label">Sampling mode:</span>
          <span class="sampling-summary__value">{{ samplingModeLabel }}</span>
        </div>
        <div class="sampling-summary__card sampling-summary__card--row">
          <span class="sampling-summary__label">Sampling settings:</span>
          <span class="sampling-summary__value">
            @if (samplingCountPerWindowParts) {
              <span class="sampling-summary__value-item">Message count: {{ samplingCountPerWindowParts.count ?? '—' }}</span>
              <span class="sampling-summary__value-item">Time window: {{ samplingCountPerWindowParts.window ?? '—' }}</span>
            } @else {
              {{ samplingSettingsSummary }}
            }
          </span>
        </div>
      </div>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
      <button mat-stroked-button type="button" [attr.aria-label]="'Cancel'" (click)="close()" data-testid="webhook-settings-dialog-cancel">
        Cancel
      </button>
      <button
        [disabled]="form.invalid || form.pristine || !hasFormChanged()"
        mat-raised-button
        type="button"
        color="primary"
        (click)="save()"
        data-testid="webhook-settings-dialog-save"
      >
        Save
      </button>
    </mat-dialog-actions>
  </form>
}
