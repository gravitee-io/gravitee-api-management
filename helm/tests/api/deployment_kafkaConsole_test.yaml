suite: Test Management API with APIM Kafka Console
templates:
  - "api/api-configmap.yaml"
  - "api/api-deployment.yaml"

set:
  kafkaConsole:
    enabled: true

tests:
  - it: Should generate default env variables
    template: api/api-deployment.yaml
    set:
      kafkaConsole:
        jwt:
          secret:
            value: 4j5ipCZn93qnLBykgex5pSvUdA8Nnqts
    asserts:
      - hasDocuments:
          count: 1
      - equal:
          path: spec.template.spec.containers[0].env[1].name
          value: "GRAVITEE_KAFKA_CONSOLE_SERVER_SECURITY_SECRET"
      - equal:
          path: spec.template.spec.containers[0].env[1].value
          value: "4j5ipCZn93qnLBykgex5pSvUdA8Nnqts"

  - it: Should generate with env variables using secrets
    template: api/api-deployment.yaml
    set:
      kafkaConsole:
        jwt:
          secret:
            valueFrom:
              secretKeyRef:
                name: secretJWTName
                key: secretJWTKey
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[1].name
          value: "GRAVITEE_KAFKA_CONSOLE_SERVER_SECURITY_SECRET"
      - equal:
          path: spec.template.spec.containers[0].env[1].valueFrom
          value:
            secretKeyRef:
              name: secretJWTName
              key: secretJWTKey