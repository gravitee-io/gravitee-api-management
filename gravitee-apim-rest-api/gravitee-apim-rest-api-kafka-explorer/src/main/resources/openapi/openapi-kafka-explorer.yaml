openapi: 3.0.3
info:
    title: Gravitee.io APIM - Kafka Explorer
    description: |-
        Kafka cluster exploration and management API for Gravitee APIM.
    contact:
        email: team-apim@graviteesource.com
    license:
        name: Apache 2.0
        url: http://www.apache.org/licenses/LICENSE-2.0.html
    version: 1.0.0

tags:
    - name: Kafka Explorer
      description: Kafka Explorer module information

paths:
    /kafka-explorer/describe-cluster:
        post:
            tags:
                - Kafka Explorer
            summary: Describe a Kafka cluster
            description: |
                Connects to a Kafka cluster and returns its metadata including cluster ID, controller, and nodes.
            operationId: describeCluster
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/DescribeClusterRequest"
            responses:
                "200":
                    description: Cluster metadata
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/DescribeClusterResponse"
                "400":
                    description: Invalid parameters
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/KafkaExplorerError"
                "502":
                    description: Connection failure
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/KafkaExplorerError"

    /kafka-explorer/list-topics:
        post:
            tags:
                - Kafka Explorer
            summary: List topics of a Kafka cluster
            description: |
                Connects to a Kafka cluster and returns the list of topics with their metadata.
            operationId: listTopics
            parameters:
                - name: page
                  in: query
                  schema:
                      type: integer
                      default: 1
                  description: Page number (1-based)
                - name: perPage
                  in: query
                  schema:
                      type: integer
                      default: 10
                  description: Number of topics per page
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/ListTopicsRequest"
            responses:
                "200":
                    description: List of topics
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ListTopicsResponse"
                "400":
                    description: Invalid parameters
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/KafkaExplorerError"
                "502":
                    description: Connection failure
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/KafkaExplorerError"

components:
    schemas:
        DescribeClusterRequest:
            type: object
            required:
                - clusterId
            properties:
                clusterId:
                    type: string
                    description: ID of the Cluster to connect to

        DescribeClusterResponse:
            type: object
            properties:
                clusterId:
                    type: string
                controller:
                    $ref: "#/components/schemas/KafkaNode"
                nodes:
                    type: array
                    items:
                        $ref: "#/components/schemas/BrokerDetail"
                totalTopics:
                    type: integer
                    format: int32
                    description: Total number of topics in the cluster
                totalPartitions:
                    type: integer
                    format: int32
                    description: Total number of partitions across all topics

        KafkaNode:
            type: object
            properties:
                id:
                    type: integer
                    format: int32
                host:
                    type: string
                port:
                    type: integer
                    format: int32

        BrokerDetail:
            type: object
            properties:
                id:
                    type: integer
                    format: int32
                host:
                    type: string
                port:
                    type: integer
                    format: int32
                rack:
                    type: string
                    description: Rack identifier of this broker, or null if not configured
                leaderPartitions:
                    type: integer
                    format: int32
                    description: Number of partitions for which this broker is the leader
                replicaPartitions:
                    type: integer
                    format: int32
                    description: Number of partition replicas hosted on this broker
                logDirSize:
                    type: integer
                    format: int64
                    description: Total size of all log directories on this broker in bytes, or null if unavailable

        ListTopicsRequest:
            type: object
            required:
                - clusterId
            properties:
                clusterId:
                    type: string
                    description: ID of the Cluster to connect to
                nameFilter:
                    type: string
                    description: Optional filter to match topic names (case-insensitive contains)

        ListTopicsResponse:
            type: object
            properties:
                data:
                    type: array
                    items:
                        $ref: "#/components/schemas/KafkaTopic"
                pagination:
                    $ref: "#/components/schemas/Pagination"

        Pagination:
            type: object
            properties:
                page:
                    type: integer
                perPage:
                    type: integer
                pageCount:
                    type: integer
                pageItemsCount:
                    type: integer
                totalCount:
                    type: integer
                    format: int64

        KafkaTopic:
            type: object
            properties:
                name:
                    type: string
                partitionCount:
                    type: integer
                    format: int32
                    description: Number of partitions for this topic
                replicationFactor:
                    type: integer
                    format: int32
                    description: Replication factor of this topic
                underReplicatedCount:
                    type: integer
                    format: int32
                    description: Number of partitions where ISR size is less than replica count
                internal:
                    type: boolean
                    description: Whether this is an internal Kafka topic
                size:
                    type: integer
                    format: int64
                    description: Total size of the topic in bytes across all brokers, or null if unavailable
                messageCount:
                    type: integer
                    format: int64
                    description: Total number of messages (sum of latest offsets), or null if unavailable

        KafkaExplorerError:
            type: object
            properties:
                message:
                    type: string
                technicalCode:
                    type: string
                    description: Technical code to identify error type (CONNECTION_FAILED, AUTHENTICATION_FAILED, TIMEOUT, etc.)
