openapi: 3.0.3
info:
  title: Gravitee.io APIM - Management API - API Products
  description: |-
    This is the OpenAPI specification for API Products in APIM Management API v2.
    API Products allow you to bundle multiple APIs together into a single product offering.
  contact:
    name: GraviteeSource Team
    url: https://gravitee.io
    email: team-apim@graviteesource.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: 2.0.0

security:
  - BasicAuth: []
  - CookieAuth: []

servers:
  - url: "/management/v2"
    description: APIM Management API v2 - Default base URL
  - url: "/management/v2/organizations/{orgId}"
    description: APIM Management API v2 - Base URL to target specific organizations
    variables:
      orgId:
        description: The unique ID of your organization
        default: DEFAULT

tags:
  - name: API Products
    description: Everything about API Products - collections of bundled APIs

paths:
  /environments/{envId}/api-products/_verify:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
    post:
      parameters:
        - $ref: "#/components/parameters/envIdParam"
      tags:
        - API Products
      summary: Verify API Product name uniqueness
      description: |-
        Verify that the API Product name is unique before creating or updating an API Product.<br>
        This will check that the name is not already used by other API Products in the environment.<br>
        The result will indicate if the name is OK, and give the reason of the failure if it is not (name already exists, etc.)
      operationId: verifyApiProductName
      requestBody:
        description: API Product verification request containing the name to verify and optional apiProductId for update scenarios
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyApiProduct"
        required: true
      responses:
        "200":
          $ref: "#/components/responses/VerifyApiProductResponse"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /environments/{envId}/api-products:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
    get:
      tags:
        - API Products
      summary: List all API Products in the environment
      description: |-
        Retrieve a paginated list of all API Products in the specified environment.
      operationId: getApiProducts
      parameters:
        - name: page
          in: query
          description: Page number (starting from 1)
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: perPage
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: List of API Products
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ApiProduct'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                      perPage:
                        type: integer
                        example: 10
                      pageCount:
                        type: integer
                        example: 1
                      totalCount:
                        type: integer
                        example: 1
                  links:
                    type: object
                    properties:
                      self:
                        type: string
                        example: "/management/v2/environments/DEFAULT/api-products?page=1&perPage=10"
                      next:
                        type: string
                        nullable: true
                        example: null
                      prev:
                        type: string
                        nullable: true
                        example: null
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - API Products
      summary: Create an API Product
      description: |-
        Create a new API Product in the given environment.
        The API Product name must be unique within the environment.
      operationId: createApiProduct
      requestBody:
        required: true
        description: API Product creation payload
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateApiProduct"
      responses:
        "201":
          description: API Product successfully created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiProduct"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "409":
          description: Conflict - API Product name already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                httpStatus: 409
                message: "API Product name already exists"
                technicalCode: "api.product.name.exists"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /environments/{envId}/api-products/{apiProductId}:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    get:
      tags:
        - API Products
      summary: Get an API Product by ID
      parameters:
        - name: envId
          in: path
          required: true
          schema:
            type: string
        - name: apiProductId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: The API Product
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProduct'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags:
        - API Products
      summary: Update an API Product by ID
      description: Update an existing API Product in the environment.
      operationId: updateApiProduct
      requestBody:
        required: true
        description: API Product update payload
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateApiProduct"
      responses:
        '200':
          description: API Product successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProduct'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - API Products
      summary: Delete an API Product by ID
      description: Delete an existing API Product in the environment.
      operationId: deleteApiProduct
      responses:
        '204':
          description: API Product successfully deleted
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/apis:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    delete:
      tags:
        - API Products
      summary: Delete all APIs from an API Product
      description: Remove all APIs from the specified API Product in the environment.
      operationId: deleteAllApisFromApiProduct
      responses:
        '204':
          description: All APIs successfully deleted from the API Product
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/apis/{apiId}:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: apiId
        in: path
        description: The ID of the API to remove from the product
        required: true
        schema:
          type: string
    delete:
      tags:
        - API Products
      summary: Delete a specific API from an API Product
      description: Remove a single API from the specified API Product in the environment.
      operationId: deleteApiFromApiProduct
      responses:
        '204':
          description: API successfully deleted from the API Product
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/plans:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    get:
      parameters:
        - name: statuses
          in: query
          required: false
          description: List of status filters
          schema:
            type: array
            items:
              $ref: "#/components/schemas/PlanStatus"
            default: [ "published" ]
          explode: false
        - name: securities
          in: query
          required: false
          description: List of security plan type filters
          schema:
            type: array
            items:
              $ref: "#/components/schemas/PlanSecurityType"
          explode: false
        - name: mode
          in: query
          required: false
          description: Mode of plan
          schema:
            $ref: "#/components/schemas/PlanMode"
        - name: subscribableBy
          in: query
          required: false
          description: Application's identifier. Allow user to get API Product's plans subscribable by an application.
          schema:
            type: string
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/perPageParam"
      tags:
        - API Product Plans
      summary: List the API Product's plans
      description: |
        List plans for a given API Product, always filtered by a `status` and the possibility to filter by `security`.<br>
        The results are paginated.
        
        User must have API_PRODUCT_PLAN[READ] permissions to access endpoint.
      operationId: listApiProductPlans
      responses:
        "200":
          $ref: "#/components/responses/ApiProductPlansResponse"
        default:
          $ref: "#/components/responses/Error"
    post:
      tags:
        - API Product Plans
      summary: Create an API Product's plan
      description: |-
        Create a new plan on a given API Product.
        
        User must have the API_PRODUCT_PLAN[CREATE] permission.
      operationId: createApiProductPlan
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateApiProductPlan"
        required: true
      responses:
        "201":
          description: Plan successfully created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiProductPlan"
        default:
          $ref: "#/components/responses/Error"

  /environments/{envId}/api-products/{apiProductId}/plans/{planId}:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - $ref: "#/components/parameters/apiProductPlanIdParam"
    get:
      tags:
        - API Product Plans
      summary: Get one API Product's plan
      description: |-
        Get the API Product's plan by its identifier.
        
        User must have the API_PRODUCT_PLAN[READ] permission.
      operationId: getApiProductPlan
      responses:
        "200":
          description: An API Product's plan
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiProductPlan"
        default:
          $ref: "#/components/responses/Error"
    put:
      tags:
        - API Product Plans
      summary: Update one API Product's plan
      description: |-
        Update the API Product's plan.
        
        User must have the API_PRODUCT_PLAN[UPDATE] permission.
      operationId: updateApiProductPlan
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateApiProductPlan"
        required: true
      responses:
        "200":
          description: API Product's plan successfully updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiProductPlan"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - API Product Plans
      summary: Delete one API Product's plan
      description: |-
        Delete the API Product's plan.
        
        User must have the API_PRODUCT_PLAN[DELETE] permission.
      operationId: deleteApiProductPlan
      responses:
        "204":
          description: API Product's plan successfully deleted
        default:
          $ref: "#/components/responses/Error"

  /environments/{envId}/api-products/{apiProductId}/plans/{planId}/_close:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - $ref: "#/components/parameters/apiProductPlanIdParam"
    post:
      tags:
        - API Product Plans
      summary: Close an API Product's plan
      description: |-
        Close the API Product's plan.
        
        User must have the API_PRODUCT_PLAN[UPDATE] permission.
      operationId: closeApiProductPlan
      responses:
        "200":
          description: API Product's plan successfully closed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiProductPlan"
        default:
          $ref: "#/components/responses/Error"

  /environments/{envId}/api-products/{apiProductId}/plans/{planId}/_deprecate:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - $ref: "#/components/parameters/apiProductPlanIdParam"
    post:
      tags:
        - API Product Plans
      summary: Deprecate an API Product's plan
      description: |-
        Deprecate the API Product's plan.
        
        User must have the API_PRODUCT_PLAN[UPDATE] permission.
      operationId: deprecateApiProductPlan
      responses:
        "200":
          description: API Product's plan successfully deprecated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiProductPlan"
        default:
          $ref: "#/components/responses/Error"

  /environments/{envId}/api-products/{apiProductId}/plans/{planId}/_publish:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - $ref: "#/components/parameters/apiProductPlanIdParam"
    post:
      tags:
        - API Product Plans
      summary: Publish an API Product's plan
      description: |-
        Publish the API Product's plan.
        
        User must have the API_PRODUCT_PLAN[UPDATE] permission.
      operationId: publishApiProductPlan
      responses:
        "200":
          description: API Product's plan successfully published
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiProductPlan"
        default:
          $ref: "#/components/responses/Error"

  /environments/{envId}/api-products/{apiProductId}/subscriptions:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    get:
      tags:
        - API Products
      summary: List subscriptions for the API Product
      description: List all subscriptions for the specified API Product. User must have API_PRODUCT_SUBSCRIPTION[READ] permission.
      operationId: getApiProductSubscriptions
      parameters:
        - name: page
          in: query
          description: Page number (starting from 1)
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: perPage
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: Paged list of API Product subscriptions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - API Products
      summary: Create a subscription to an API Product plan
      description: Subscribe an application to an API Product plan. User must have API_PRODUCT_SUBSCRIPTION[CREATE] permission.
      operationId: createApiProductSubscription
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSubscription'
      responses:
        '201':
          description: Subscription successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        description: The ID of the subscription
        required: true
        schema:
          type: string
    get:
      tags:
        - API Products
      summary: Get an API Product subscription by ID
      description: User must have API_PRODUCT_SUBSCRIPTION[READ] permission.
      operationId: getApiProductSubscription
      responses:
        '200':
          description: The API Product subscription
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - API Products
      summary: Update an API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: updateApiProductSubscription
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSubscription'
      responses:
        '200':
          description: Subscription successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_accept:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Products
      summary: Accept an API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: acceptApiProductSubscription
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AcceptSubscription'
      responses:
        '200':
          description: Subscription accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_reject:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Products
      summary: Reject an API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: rejectApiProductSubscription
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RejectSubscription'
      responses:
        '200':
          description: Subscription rejected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_close:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Products
      summary: Close an API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: closeApiProductSubscription
      responses:
        '200':
          description: Subscription closed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  parameters:
    envIdParam:
      name: envId
      in: path
      description: The ID of the environment
      required: true
      schema:
        type: string
        example: DEFAULT

    apiProductIdParam:
      name: apiProductId
      in: path
      description: The ID of the API Product
      required: true
      schema:
        type: string

    apiProductPlanIdParam:
      name: planId
      in: path
      required: true
      description: Id of a plan.
      schema:
        type: string

    pageParam:
      name: page
      in: query
      required: false
      description: The page number for pagination.
      schema:
        type: integer
        default: 1

    perPageParam:
      name: perPage
      in: query
      required: false
      description: |
        The number of items per page for pagination.
      schema:
        type: integer
        default: 10

  schemas:
    VerifyApiProduct:
      type: object
      title: "VerifyApiProduct"
      description: Request body for verifying API Product name uniqueness
      properties:
        name:
          type: string
          description: The API Product name to verify
          example: "My API Product"
          minLength: 1
          maxLength: 255
        apiProductId:
          type: string
          description: Optional API Product ID for update scenarios. When provided, the verification will exclude this API Product from the uniqueness check.
          example: "api-product-123"
      required:
        - name

    VerifyApiProductResponse:
      type: object
      title: "VerifyApiProductResponse"
      description: Response indicating whether the API Product name is valid and unique
      properties:
        ok:
          type: boolean
          description: Indicates whether the API Product name is valid and unique
          example: true
        reason:
          type: string
          description: An optional reason giving details about the result. Present when ok is false.
          example: "API Product name already exists"

    CreateApiProduct:
      type: object
      title: "CreateApiProduct"
      description: Request body to create an API Product
      properties:
        name:
          type: string
          description: The API Product name
          minLength: 1
          maxLength: 255
          example: "My API Product"
        description:
          type: string
          description: The API Product description
          example: "A bundle of public APIs"
        version:
          type: string
          description: The API Product version
          example: "1.0.0"
        apiIds:
          type: array
          description: List of API IDs included in the product
          items:
            type: string
          example:
            - "api-1"
            - "api-2"
      required:
        - name
        - version

    UpdateApiProduct:
      type: object
      title: "UpdateApiProduct"
      description: Request body to update an API Product
      properties:
        name:
          type: string
          description: The API Product name
          minLength: 1
          maxLength: 255
          example: "My Updated API Product"
        description:
          type: string
          description: The API Product description
          example: "An updated bundle of public APIs"
        version:
          type: string
          description: The API Product version
          example: "1.0.1"
        apiIds:
          type: array
          description: List of API IDs included in the product
          items:
            type: string
          example:
            - "api-1"
            - "api-2"
      required:
        - name
        - version

    ApiProduct:
      type: object
      title: "ApiProduct"
      description: API Product representation
      properties:
        id:
          type: string
          description: The API Product ID
          example: "api-product-123"
        environmentId:
          type: string
          description: The environment ID
          example: "DEFAULT"
        name:
          type: string
          description: The API Product name
          example: "My API Product"
        description:
          type: string
          description: The API Product description
          example: "A bundle of public APIs"
        version:
          type: string
          description: The API Product version
          example: "1.0.0"
        apiIds:
          type: array
          description: List of API IDs included in the product
          items:
            type: string
          example:
            - "api-1"
            - "api-2"
        createdAt:
          type: string
          format: date-time
          description: API Product creation date
          example: "2025-01-01T10:15:30Z"
        updatedAt:
          type: string
          format: date-time
          description: API Product last update date
          example: "2025-01-01T10:15:30Z"
        primaryOwner:
          $ref: '#/components/schemas/PrimaryOwner'

    PrimaryOwner:
      type: object
      description: The primary owner of the API Product
      properties:
        id:
          type: string
          description: Owner's uuid.
          example: 00f8c9e7-78fc-4907-b8c9-e778fc790750
        email:
          type: string
          description: Owner's email. Can be null if owner is a group.
        displayName:
          type: string
          description: Owner's name.
          example: John Doe
          minLength: 1
        type:
          $ref: "#/components/schemas/MembershipMemberType"

    MembershipMemberType:
      type: string
      description: The type of the member (USER or GROUP)
      enum:
        - USER
        - GROUP

    Error:
      type: object
      properties:
        httpStatus:
          type: integer
          format: int32
          description: The error code
          example: 400
        message:
          type: string
          description: The error message
          example: Bad request
        technicalCode:
          type: string
          description: A technical code to identify the error
          example: invalid.api.product.name
        parameters:
          type: object
          description: A map of parameters to be used in the error message
          additionalProperties:
            type: string
        details:
          type: array
          description: A list of details about the error
          items:
            type: object
            properties:
              message:
                type: string
                description: The error message
                example: Bad request
              location:
                type: string
                description: The json path of the field in error.
                example: verifyApiProduct.name
              invalidValue:
                description: The invalid value.

    BaseApiProductPlan:
      type: object
      properties:
        id:
          type: string
          description: Plan's uuid.
          example: 00f8c9e7-78fc-4907-b8c9-e778fc790750
        name:
          type: string
          description: Plan's name. Duplicate names can exists.
          example: My Api Product plan
        description:
          type: string
          description: Plan's description. A short description of your plan.
          example: I can use a hundred characters to describe this plan.
        apiId:
          type: string
          description: Id of the API Product owning the plan.
          example: 6c530064-0b2c-4004-9300-640b2ce0047b
        security:
          $ref: "#/components/schemas/PlanSecurity"
        mode:
          $ref: "#/components/schemas/PlanMode"
    PlanMode:
      type: string
      description: The behavioural mode of the Plan (Standard for classical plan, Push for subscription plan).
      example: STANDARD
      enum:
        - STANDARD
        - PUSH

    GenericApiProductPlan:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseApiProductPlan"
        - properties:
            characteristics:
              type: array
              items:
                type: string
            closedAt:
              type: string
              format: date-time
              description: The datetime when the plan was closed.
              example: 2023-05-25T12:40:46.184Z
            commentMessage:
              type: string
              description: A message from the API Product Publisher that is displayed to the consumer at subscription time.
              example: Explain why you want to subscribe.
            commentRequired:
              type: boolean
              description: A flag indicating if the consumer has to write a "consumer message" or if he/she can leave the field blank.
            createdAt:
              type: string
              format: date-time
              description: The last datetime when the plan was created.
              example: 2023-05-25T12:40:46.184Z
            crossId:
              type: string
              description: Plan's crossId. Identifies plan across environments.
              example: df83b2a4-cc3e-3f80-9f0d-c138c106c076

            description:
              type: string
              description: Plan's description. A short description of your plan.
              example: I can use a hundred characters to describe this plan.
            excludedGroups:
              type: array
              description: Groups of users which are not allowed to subscribe to this plan.
              example:
                - MY_GROUP1
                - MY_GROUP2
              items:
                type: string
            generalConditions:
              type: string
            order:
              type: integer
            publishedAt:
              type: string
              format: date-time
              description: The last datetime when the plan was published.
              example: 2023-05-25T12:40:46.184Z
            selectionRule:
              type: string
            status:
              $ref: "#/components/schemas/PlanStatus"
            tags:
              type: array
              description: The list of sharding tags associated with this plan.
              example:
                - public
                - private
              items:
                type: string
            type:
              $ref: "#/components/schemas/PlanType"
            updatedAt:
              type: string
              format: date-time
              description: The last datetime when the plan was updated.
              example: 2023-05-25T12:40:46.184Z
            validation:
              $ref: "#/components/schemas/ProductPlanValidation"
          required:
            - definitionVersion

    ApiProductPlan:
      type: object
      title: "ProductPlan"
      allOf:
        - $ref: "#/components/schemas/GenericApiProductPlan"
    PlanSecurity:
      type: object
      properties:
        type:
          $ref: "#/components/schemas/PlanSecurityType"
        configuration:
          type: object
      required:
        - type

    PlanSecurityType:
      type: string
      description: Plan security type.
      example: KEY_LESS
      enum:
        - KEY_LESS
        - API_KEY
        - OAUTH2
        - JWT
        - MTLS

    PlanStatus:
      type: string
      description: Plan status.
      example: STAGING
      enum:
        - STAGING
        - PUBLISHED
        - DEPRECATED
        - CLOSED
    PlanType:
      type: string
      description: Plan type.
      example: API
      enum:
        - API
        - CATALOG
        - API_PRODUCT
    ProductPlanValidation:
      type: string
      description: Plan validation type.
      example: AUTO
      enum:
        - AUTO
        - MANUAL

    Pagination:
      description: Generic object to handle pagination data.
      type: object
      properties:
        page:
          type: integer
          description: The current page.
        perPage:
          type: integer
          description: The number of items requested per page.
        pageCount:
          type: integer
          description: The total number of pages.
        pageItemsCount:
          type: integer
          description: The number of items for the current page.
        totalCount:
          type: integer
          format: int64
          description: The total number of items.

    CreateApiProductPlan:
      type: object
      title: "CreateApiProductPlan"
      allOf:
        - $ref: "#/components/schemas/CreateGenericApiProductPlan"
        - properties:

            mode:
              $ref: "#/components/schemas/PlanMode"

    CreateGenericApiProductPlan:
      type: object
      properties:
        crossId:
          type: string
          description: Plan's crossId. Identifies plan across environments.
          example: df83b2a4-cc3e-3f80-9f0d-c138c106c076
        characteristics:
          type: array
          items:
            type: string
        commentMessage:
          type: string
          description: A message from the API Product Publisher that is displayed to the consumer at subscription time.
          example: Explain why you want to subscribe.
        commentRequired:
          type: boolean
          description: A flag indicating if the consumer has to write a "consumer message" or if he/she can leave the field blank.

        description:
          type: string
          description: Plan's description. A short description of your Plan.
          example: I can use a hundred characters to describe this plan.
        excludedGroups:
          type: array
          description: Groups of users which are not allowed to subscribe to this plan.
          example:
            - MY_GROUP1
            - MY_GROUP2
          items:
            type: string
        generalConditions:
          type: string
          description: This field contains the UUID of the documentation page that is used as General Conditions.
          example: 4e3de652-2301-48ba-bde6-522301e8ba3a
        name:
          type: string
          description: Plan's name. Duplicate names can exists.
          example: My Api Product plan
        order:
          type: integer
          description: Simple order that could be used by a front end to display plans in a certain order. To highlight a plan on the portal for instance.
          example: 0
        security:
          $ref: "#/components/schemas/PlanSecurity"
        selectionRule:
          type: string
          description: An optional EL expression that will be evaluated at request time to select this plan.
        tags:
          type: array
          description: The list of sharding tags associated with this plan.
          example:
            - public
            - private
          items:
            type: string
        validation:
          $ref: "#/components/schemas/ProductPlanValidation"
      required:
        - definitionVersion

    UpdateGenericApiProductPlan:
      type: object
      properties:
        crossId:
          type: string
          description: Plan's crossId. Identifies plan across environments.
          example: df83b2a4-cc3e-3f80-9f0d-c138c106c076
        characteristics:
          type: array
          items:
            type: string
        commentMessage:
          type: string
          description: A message from the API Product Publisher that is displayed to the consumer at subscription time.
          example: Explain why you want to subscribe.
        commentRequired:
          type: boolean
          description: A flag indicating if the consumer has to write a "consumer message" or if he/she can leave the field blank.

        description:
          type: string
          description: Plan's description. A short description of your Plan.
          example: I can use a hundred characters to describe this plan.
        excludedGroups:
          type: array
          description: Groups of users which are not allowed to subscribe to this plan.
          example:
            - MY_GROUP1
            - MY_GROUP2
          items:
            type: string
        generalConditions:
          type: string
          description: This field contains the UUID of the documentation page that is used as General Conditions.
          example: 4e3de652-2301-48ba-bde6-522301e8ba3a
        name:
          type: string
          description: Plan's name. Duplicate names can exists.
          example: My Api Product plan
        order:
          type: integer
          description: Simple order that could be used by a front end to display plans in a certain order. To highlight a plan on the portal for instance.
          example: 0
        security:
          type: object
          properties:
            configuration:
              type: object
        validation:
          $ref: "#/components/schemas/ProductPlanValidation"

      required:
        - definitionVersion

    UpdateApiProductPlan:
      type: object
      title: "UpdateProductPlan"
      allOf:
        - $ref: "#/components/schemas/UpdateGenericApiProductPlan"
        - properties:
            selectionRule:
              type: string
              description: An optional EL expression that will be evaluated at request time to select this plan.
            tags:
              type: array
              description: The list of sharding tags associated with this plan.
              example:
                - public
                - private
              items:
                type: string

    Links:
      description: List of links for pagination
      properties:
        self:
          type: string
          description: Link to current resource
        first:
          type: string
          description: In a paginated response, link to the first page
        last:
          type: string
          description: In a paginated response, link to the last page
        previous:
          type: string
          description: In a paginated response, link to the previous page. Maybe null if current is the first page
        next:
          type: string
          description: In a paginated response, link to the next page. Maybe null if current is the last page

    Subscription:
      type: object
      description: Subscription representation (same structure as API subscription)
      properties:
        id:
          type: string
          description: Subscription's uuid.
          example: 34f8c9e7-68fd-4922-b8c9-e778fc790777
    CreateSubscription:
      type: object
      description: Request to create a subscription (applicationId, planId, etc.)
      properties:
        applicationId:
          type: string
        planId:
          type: string
        customApiKey:
          type: string
        consumerConfiguration:
          type: object
        metadata:
          type: object
          additionalProperties:
            type: string
      required:
        - applicationId
        - planId
    UpdateSubscription:
      type: object
      description: Request to update a subscription
      properties:
        consumerConfiguration:
          type: object
        metadata:
          type: object
          additionalProperties:
            type: string
        startingAt:
          type: string
          format: date-time
        endingAt:
          type: string
          format: date-time
    AcceptSubscription:
      type: object
      description: Request to accept a subscription
      properties:
        startingAt:
          type: string
          format: date-time
        endingAt:
          type: string
          format: date-time
        reason:
          type: string
        customApiKey:
          type: string
    RejectSubscription:
      type: object
      description: Request to reject a subscription
      properties:
        reason:
          type: string
    SubscriptionsResponse:
      type: object
      description: Paged list of subscriptions
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Subscription'
        pagination:
          type: object
        links:
          type: object

  responses:
    VerifyApiProductResponse:
      description: Result of the API Product name verification
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/VerifyApiProductResponse"
          examples:
            success:
              summary: Name is available
              value:
                ok: true
            nameExists:
              summary: Name already exists
              value:
                ok: false
                reason: "An API Product with this name already exists"

    BadRequestError:
      description: Bad Request - Invalid request body or parameters
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            httpStatus: 400
            message: "Invalid request body"
            technicalCode: "invalid.request"
            details: []

    UnauthorizedError:
      description: Unauthorized - Authentication is required
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            httpStatus: 401
            message: "Unauthorized"
            technicalCode: "unauthorized"
            details: []

    ForbiddenError:
      description: Forbidden - User lacks required permissions
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            httpStatus: 403
            message: "Forbidden"
            technicalCode: "forbidden"
            details: []

    InternalServerError:
      description: Internal Server Error - Server error during verification
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            httpStatus: 500
            message: "Internal server error"
            technicalCode: "internal.error"
            details: []

    ApiProductPlansResponse:
      description: Page of API Product plans
      content:
        application/json:
          schema:
            title: "ApiProductPlansResponse"
            properties:
              data:
                description: List of API Product plans.
                type: array
                items:
                  $ref: "#/components/schemas/ApiProductPlan"
              pagination:
                $ref: "#/components/schemas/Pagination"
              links:
                $ref: "#/components/schemas/Links"

    Error:
      description: Generic error response
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
    CookieAuth:
      type: apiKey
      in: cookie
      name: Auth-Graviteeio-APIM