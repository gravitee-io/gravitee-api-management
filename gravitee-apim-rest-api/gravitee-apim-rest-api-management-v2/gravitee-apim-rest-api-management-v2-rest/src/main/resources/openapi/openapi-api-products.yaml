openapi: 3.0.3
info:
  title: Gravitee.io APIM - Management API - API Products
  description: |-
    This is the OpenAPI specification for API Products in APIM Management API v2.
    API Products allow you to bundle multiple APIs together into a single product offering.
  contact:
    name: GraviteeSource Team
    url: https://gravitee.io
    email: team-apim@graviteesource.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: 2.0.0

security:
  - BasicAuth: []
  - CookieAuth: []

servers:
  - url: "/management/v2"
    description: APIM Management API v2 - Default base URL
  - url: "/management/v2/organizations/{orgId}"
    description: APIM Management API v2 - Base URL to target specific organizations
    variables:
      orgId:
        description: The unique ID of your organization
        default: DEFAULT

tags:
  - name: API Product
    description: API Product lifecycle - create, read, update, delete, verify, deploy
  - name: API Product Members
    description: Manage API Product members and their permissions
  - name: API Product Subscriptions
    description: Subscribe applications to API Product plans and manage subscriptions
  - name: API Product Plans
    description: Define and manage plans (pricing/access tiers) for API Products

paths:
  /environments/{envId}/api-products/_verify:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
    post:
      parameters:
        - $ref: "#/components/parameters/envIdParam"
      tags:
        - API Product
      summary: Verify API Product name uniqueness
      description: |-
        Verify that the API Product name is unique before creating or updating an API Product.<br>
        This will check that the name is not already used by other API Products in the environment.<br>
        The result will indicate if the name is OK, and give the reason of the failure if it is not (name already exists, etc.)
      operationId: verifyApiProductName
      requestBody:
        description: API Product verification request containing the name to verify and optional apiProductId for update scenarios
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyApiProduct"
        required: true
      responses:
        "200":
          $ref: "#/components/responses/VerifyApiProductResponse"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /environments/{envId}/api-products:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
    get:
      tags:
        - API Product
      summary: List all API Products in the environment
      description: |-
        Retrieve a paginated list of all API Products in the specified environment.
      operationId: getApiProducts
      parameters:
        - name: page
          in: query
          description: Page number (starting from 1)
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: perPage
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: List of API Products
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ApiProduct'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                      perPage:
                        type: integer
                        example: 10
                      pageCount:
                        type: integer
                        example: 1
                      totalCount:
                        type: integer
                        example: 1
                  links:
                    type: object
                    properties:
                      self:
                        type: string
                        example: "/management/v2/environments/DEFAULT/api-products?page=1&perPage=10"
                      next:
                        type: string
                        nullable: true
                        example: null
                      prev:
                        type: string
                        nullable: true
                        example: null
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - API Product
      summary: Create an API Product
      description: |-
        Create a new API Product in the given environment.
        The API Product name must be unique within the environment.
        
        **API ID Validation:**
        - All provided API IDs must exist in the environment
        - All APIs must be V4 definition version
        - All APIs must have `allowedInApiProducts` flag set to `true`
        - If any API ID is invalid, a 400 error will be returned with details
      operationId: createApiProduct
      requestBody:
        required: true
        description: API Product creation payload
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateApiProduct"
      responses:
        "201":
          description: API Product successfully created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiProduct"
        "400":
          description: Bad Request - Invalid request body, invalid API IDs, or validation errors
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                invalidApiIds:
                  summary: Invalid API IDs provided
                  value:
                    httpStatus: 400
                    message: "These APIs [api-1, api-2] do not exist. Only V4 API definition is supported. These APIs [api-3] are not V4"
                    parameters:
                      nonExistentApiIds: "api-1, api-2"
                      invalidApiIds: "api-3"
                apisNotAllowed:
                  summary: APIs not allowed in API Products
                  value:
                    httpStatus: 400
                    message: "These APIs [api-4] are not allowed in API Products"
                    parameters:
                      notAllowedApiIds: "api-4"
                multipleErrors:
                  summary: Multiple validation errors
                  value:
                    httpStatus: 400
                    message: "These APIs [api-1] do not exist. Only V4 API definition is supported. These APIs [api-2] are not V4. These APIs [api-3] are not allowed in API Products"
                    parameters:
                      nonExistentApiIds: "api-1"
                      invalidApiIds: "api-2"
                      notAllowedApiIds: "api-3"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "409":
          description: Conflict - API Product name already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                httpStatus: 409
                message: "API Product name already exists"
                technicalCode: "api.product.name.exists"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /environments/{envId}/api-products/_search:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
    post:
      tags:
        - API Product
      summary: Search API Products by name or ID
      description: |-
        Search API Products in the environment by name (substring match) and/or by a list of IDs.
        Optionally filter by text `query` (name, description and owner name) and/or `ids`. If none are provided, all API Products in the environment are returned (paginated).
        Results are paginated.
      operationId: searchApiProducts
      parameters:
        - name: page
          in: query
          description: Page number (starting from 1)
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: perPage
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: sortBy
          in: query
          description: Sort by name. Use "name" for ascending, "-name" for descending. Default is name ascending.
          required: false
          schema:
            type: string
            enum:
              - name
              - "-name"
            default: name
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ApiProductSearchQuery"
      responses:
        '200':
          description: Paginated list of API Products matching the search
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ApiProduct'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                      perPage:
                        type: integer
                        example: 10
                      pageCount:
                        type: integer
                        example: 1
                      totalCount:
                        type: integer
                        example: 1
                  links:
                    type: object
                    properties:
                      self:
                        type: string
                      next:
                        type: string
                        nullable: true
                      prev:
                        type: string
                        nullable: true
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    get:
      tags:
        - API Product
      summary: Get an API Product by ID
      parameters:
        - name: envId
          in: path
          required: true
          schema:
            type: string
        - name: apiProductId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: The API Product
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProduct'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags:
        - API Product
      summary: Update an API Product by ID
      description: |
        Update an existing API Product in the environment.
        The `apiIds` field should be managed through this endpoint, similar to how groups are managed in APIs.
        When `apiIds` is provided, it will REPLACE the entire list of APIs (not merge).
        
        **API ID Validation:**
        - All provided API IDs must exist in the environment
        - All APIs must be V4 definition version
        - All APIs must have `allowedInApiProducts` flag set to `true`
        - If any API ID is invalid, a 400 error will be returned with details
      operationId: updateApiProduct
      requestBody:
        required: true
        description: API Product update payload
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateApiProduct"
      responses:
        '200':
          description: API Product successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProduct'
        '400':
          description: Bad Request - Invalid request body, invalid API IDs, or validation errors
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                invalidApiIds:
                  summary: Invalid API IDs provided
                  value:
                    httpStatus: 400
                    message: "These APIs [api-1, api-2] do not exist. Only V4 API definition is supported. These APIs [api-3] are not V4"
                    parameters:
                      nonExistentApiIds: "api-1, api-2"
                      invalidApiIds: "api-3"
                apisNotAllowed:
                  summary: APIs not allowed in API Products
                  value:
                    httpStatus: 400
                    message: "These APIs [api-4] are not allowed in API Products"
                    parameters:
                      notAllowedApiIds: "api-4"
                multipleErrors:
                  summary: Multiple validation errors
                  value:
                    httpStatus: 400
                    message: "These APIs [api-1] do not exist. Only V4 API definition is supported. These APIs [api-2] are not V4. These APIs [api-3] are not allowed in API Products"
                    parameters:
                      nonExistentApiIds: "api-1"
                      invalidApiIds: "api-2"
                      notAllowedApiIds: "api-3"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - API Product
      summary: Delete an API Product by ID
      description: Delete an existing API Product in the environment.
      operationId: deleteApiProduct
      responses:
        '204':
          description: API Product successfully deleted
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/members/permissions:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    get:
      tags:
        - API Product Members
      summary: Get API Product member permissions
      description: |-
        Get the permissions of the current user for the API Product.
        Returns a map of permission names to allowed actions (CRUD) for the authenticated user.
        Admins receive all permissions; other users receive their membership-based permissions.
      operationId: getApiProductMemberPermissions
      responses:
        '200':
          description: Map of permission names to allowed actions (e.g. CREATE, READ, UPDATE, DELETE)
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string
                  description: Allowed action IDs as a string (e.g. "CRUD" for Create, Read, Update, Delete)
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/deployments/_verify:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    get:
      tags:
        - API Product
      summary: Check if a deployment is possible
      description: |-
        Verifies whether the API Product can be deployed to gateway instances, based on the current license.

        User must have the API_PRODUCT_DEFINITION[READ] permission.
      operationId: verifyApiProductDeployment
      responses:
        "200":
          description: Verification successfully performed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyApiProductDeploymentResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        default:
          $ref: '#/components/responses/Error'

  /environments/{envId}/api-products/{apiProductId}/deployments:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    post:
      tags:
        - API Product
      summary: Request a deployment to gateway instances
      description: |-
        Request a deployment for a given API Product. <br>
        Triggers the API Product to be synchronized to gateway instances.

        User must have the API_PRODUCT_DEFINITION[UPDATE] permission.
      operationId: deployApiProduct
      requestBody:
        content:
          application/json:
            schema:
              type: object
              description: Empty object or deployment options
      responses:
        "202":
          description: API Product deployment request received
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProduct'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/plans:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    get:
      tags:
        - API Product Plans
      summary: List plans for the API Product
      description: List all plans of the API Product. User must have API_PRODUCT_PLAN[READ] permission.
      operationId: getApiProductPlans
      parameters:
        - name: statuses
          in: query
          description: Filter by plan status(es)
          required: false
          schema:
            type: array
            items:
              $ref: "#/components/schemas/PlanStatus"
            default: ["PUBLISHED"]
        - name: securities
          in: query
          description: Filter by security type(s)
          required: true
          schema:
            type: array
            items:
              $ref: "#/components/schemas/PlanSecurityType"
        - name: mode
          in: query
          description: Filter by plan mode (STANDARD or PUSH)
          required: false
          schema:
            $ref: "#/components/schemas/PlanMode"
        - name: subscribableBy
          in: query
          description: Filter plans subscribable by the given user/group
          required: false
          schema:
            type: string
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/perPageParam"
      responses:
        '200':
          $ref: '#/components/responses/ApiProductPlansResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - API Product Plans
      summary: Create a plan for the API Product
      description: Create a new plan. User must have API_PRODUCT_PLAN[CREATE] permission.
      operationId: createApiProductPlan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateApiProductPlan'
      responses:
        '201':
          description: Plan successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProductPlan'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/plans/{planId}:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - $ref: "#/components/parameters/apiProductPlanIdParam"
    get:
      tags:
        - API Product Plans
      summary: Get an API Product plan by ID
      description: User must have API_PRODUCT_PLAN[READ] permission.
      operationId: getApiProductPlan
      responses:
        '200':
          description: The API Product plan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProductPlan'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - API Product Plans
      summary: Update an API Product plan
      description: User must have API_PRODUCT_PLAN[UPDATE] permission.
      operationId: updateApiProductPlan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGenericApiProductPlan'
      responses:
        '200':
          description: Plan successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProductPlan'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - API Product Plans
      summary: Delete an API Product plan
      description: User must have API_PRODUCT_PLAN[DELETE] permission.
      operationId: deleteApiProductPlan
      responses:
        '204':
          description: Plan successfully deleted
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/plans/{planId}/_close:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - $ref: "#/components/parameters/apiProductPlanIdParam"
    post:
      tags:
        - API Product Plans
      summary: Close an API Product plan
      description: User must have API_PRODUCT_PLAN[UPDATE] permission.
      operationId: closeApiProductPlan
      responses:
        '200':
          description: Plan closed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProductPlan'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/plans/{planId}/_publish:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - $ref: "#/components/parameters/apiProductPlanIdParam"
    post:
      tags:
        - API Product Plans
      summary: Publish an API Product plan
      description: User must have API_PRODUCT_PLAN[UPDATE] permission.
      operationId: publishApiProductPlan
      responses:
        '200':
          description: Plan published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProductPlan'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/plans/{planId}/_deprecate:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - $ref: "#/components/parameters/apiProductPlanIdParam"
    post:
      tags:
        - API Product Plans
      summary: Deprecate an API Product plan
      description: User must have API_PRODUCT_PLAN[UPDATE] permission.
      operationId: deprecateApiProductPlan
      responses:
        '200':
          description: Plan deprecated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiProductPlan'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    get:
      tags:
        - API Product Subscriptions
      summary: List subscriptions for the API Product
      description: |
        List subscriptions for the specified API Product, with optional filters and expand options.
        Same query parameters and expands as the API subscriptions endpoint.

        User must have API_PRODUCT_SUBSCRIPTION[READ] permission.
      operationId: getApiProductSubscriptions
      parameters:
        - name: applicationIds
          in: query
          description: List of application ids to filter on.
          required: false
          schema:
            type: array
            items:
              type: string
          explode: false
        - name: planIds
          in: query
          description: List of plan ids to filter on.
          required: false
          schema:
            type: array
            items:
              type: string
          explode: false
        - name: statuses
          in: query
          description: List of status filters.
          required: false
          schema:
            type: array
            items:
              $ref: "#/components/schemas/SubscriptionStatus"
          explode: false
        - name: apiKey
          in: query
          description: API Key associated to the subscription to filter on.
          schema:
            type: string
        - name: expands
          in: query
          description: Expansion of data to return in subscriptions (plan, application, subscribedBy).
          required: false
          schema:
            type: array
            items:
              type: string
              enum:
                - application
                - plan
                - subscribedBy
          explode: false
        - name: page
          in: query
          description: Page number (starting from 1)
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: perPage
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: Paged list of API Product subscriptions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - API Product Subscriptions
      summary: Create a subscription to an API Product plan
      description: Subscribe an application to an API Product plan. User must have API_PRODUCT_SUBSCRIPTION[CREATE] permission.
      operationId: createApiProductSubscription
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSubscription'
      responses:
        '201':
          description: Subscription successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/_canCreate:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: key
        in: query
        description: The API Key to check.
        required: true
        schema:
          type: string
      - name: application
        in: query
        description: The application ID.
        required: true
        schema:
          type: string
    get:
      tags:
        - API Product Subscriptions
      summary: Check a subscription can be created with given API Key and application
      description: |-
        Check whether a subscription can be created with the given API Key and application for this API Product.

        User must have API_PRODUCT_SUBSCRIPTION[READ] permission.
      operationId: canCreateApiProductSubscription
      responses:
        '200':
          description: API Key creation check result (true if the key can be used, false otherwise).
          content:
            application/json:
              schema:
                type: boolean
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/_verify:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
    post:
      tags:
        - API Product Subscriptions
      summary: Check a subscription can be created
      description: |-
        Check a subscription can be created with the given API Key and application for this API Product.

        User must have API_PRODUCT_SUBSCRIPTION[CREATE] permission.
      operationId: verifyCreateApiProductSubscription
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifySubscription'
      responses:
        '200':
          description: Verification successfully performed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifySubscriptionResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        description: The ID of the subscription
        required: true
        schema:
          type: string
    get:
      tags:
        - API Product Subscriptions
      summary: Get an API Product subscription by ID
      description: User must have API_PRODUCT_SUBSCRIPTION[READ] permission.
      operationId: getApiProductSubscription
      parameters:
        - name: expands
          in: query
          description: Expansion of data to return in the subscription (plan, application, subscribedBy).
          required: false
          schema:
            type: array
            items:
              type: string
              enum:
                - application
                - plan
                - subscribedBy
          explode: false
      responses:
        '200':
          description: The API Product subscription
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - API Product Subscriptions
      summary: Update an API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: updateApiProductSubscription
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSubscription'
      responses:
        '200':
          description: Subscription successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_accept:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Accept an API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: acceptApiProductSubscription
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AcceptSubscription'
      responses:
        '200':
          description: Subscription accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_reject:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Reject an API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: rejectApiProductSubscription
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RejectSubscription'
      responses:
        '200':
          description: Subscription rejected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_close:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Close an API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: closeApiProductSubscription
      responses:
        '200':
          description: Subscription closed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_pause:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Pause an API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: pauseApiProductSubscription
      responses:
        '200':
          description: Subscription paused
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_resume:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Resume a paused API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: resumeApiProductSubscription
      responses:
        '200':
          description: Subscription resumed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_resumeFailure:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Resume a failed API Product subscription
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: resumeFailedApiProductSubscription
      responses:
        '200':
          description: Subscription resumed after failure
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/_transfer:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Transfer an API Product subscription to another plan
      description: |-
        Transfer the subscription to another API Product plan.
        The targeted plan must be published and must have the same security type.
        User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: transferApiProductSubscription
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferSubscription'
      responses:
        '200':
          description: Subscription transferred
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/api-keys:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    get:
      tags:
        - API Product Subscriptions
      summary: Get API Product subscription API Keys
      description: User must have API_PRODUCT_SUBSCRIPTION[READ] permission.
      operationId: getApiProductSubscriptionApiKeys
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/perPageParam"
      responses:
        '200':
          description: Paged list of subscription API Keys
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionApiKeysResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/api-keys/_renew:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Renew API Product subscription API Key
      description: |-
        Renew the subscription API Key; the newly created API Key is returned.
        User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: renewApiProductSubscriptionApiKeys
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RenewApiKey'
      responses:
        '200':
          description: New API Key created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKey'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/api-keys/{apiKeyId}:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
      - name: apiKeyId
        in: path
        required: true
        description: The ID of the API Key
        schema:
          type: string
    put:
      tags:
        - API Product Subscriptions
      summary: Update an API Product subscription API Key
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: updateApiProductSubscriptionApiKey
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateApiKey'
      responses:
        '200':
          description: API Key updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKey'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/api-keys/{apiKeyId}/_revoke:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
      - name: apiKeyId
        in: path
        required: true
        description: The ID of the API Key
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Revoke an API Product subscription API Key
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: revokeApiProductSubscriptionApiKey
      responses:
        '200':
          description: API Key revoked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKey'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /environments/{envId}/api-products/{apiProductId}/subscriptions/{subscriptionId}/api-keys/{apiKeyId}/_reactivate:
    parameters:
      - $ref: "#/components/parameters/envIdParam"
      - $ref: "#/components/parameters/apiProductIdParam"
      - name: subscriptionId
        in: path
        required: true
        schema:
          type: string
      - name: apiKeyId
        in: path
        required: true
        description: The ID of the API Key
        schema:
          type: string
    post:
      tags:
        - API Product Subscriptions
      summary: Reactivate an API Product subscription API Key
      description: User must have API_PRODUCT_SUBSCRIPTION[UPDATE] permission.
      operationId: reactivateApiProductSubscriptionApiKey
      responses:
        '200':
          description: API Key reactivated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKey'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  parameters:
    envIdParam:
      name: envId
      in: path
      description: The ID of the environment
      required: true
      schema:
        type: string
        example: DEFAULT

    apiProductIdParam:
      name: apiProductId
      in: path
      description: The ID of the API Product
      required: true
      schema:
        type: string

    apiProductPlanIdParam:
      name: planId
      in: path
      required: true
      description: Id of a plan.
      schema:
        type: string

    pageParam:
      name: page
      in: query
      required: false
      description: The page number for pagination.
      schema:
        type: integer
        default: 1

    perPageParam:
      name: perPage
      in: query
      required: false
      description: |
        The number of items per page for pagination.
      schema:
        type: integer
        default: 10

  schemas:
    VerifyApiProduct:
      type: object
      title: "VerifyApiProduct"
      description: Request body for verifying API Product name uniqueness
      properties:
        name:
          type: string
          description: The API Product name to verify
          example: "My API Product"
          minLength: 1
          maxLength: 255
        apiProductId:
          type: string
          description: Optional API Product ID for update scenarios. When provided, the verification will exclude this API Product from the uniqueness check.
          example: "api-product-123"
      required:
        - name

    VerifyApiProductResponse:
      type: object
      title: "VerifyApiProductResponse"
      description: Response indicating whether the API Product name is valid and unique
      properties:
        ok:
          type: boolean
          description: Indicates whether the API Product name is valid and unique
          example: true
        reason:
          type: string
          description: An optional reason giving details about the result. Present when ok is false.
          example: "API Product name already exists"

    ApiProductSearchQuery:
      type: object
      title: "ApiProductSearchQuery"
      description: Search criteria for API Products. Optionally provide query (text search on name, description and owner name) and/or ids. If none are provided, all API Products in the environment are returned (paginated).
      properties:
        query:
          type: string
          description: Filter by name (case-insensitive substring match).
          example: "My Product"
        ids:
          type: array
          description: Filter by exact API Product IDs.
          items:
            type: string
          example:
            - "api-product-1"
            - "api-product-2"
    CreateApiProduct:
      type: object
      title: "CreateApiProduct"
      description: Request body to create an API Product
      properties:
        name:
          type: string
          description: The API Product name
          minLength: 1
          maxLength: 255
          example: "My API Product"
        description:
          type: string
          description: The API Product description
          example: "A bundle of public APIs"
        version:
          type: string
          description: The API Product version
          example: "1.0.0"
        apiIds:
          type: array
          description: List of API IDs included in the product
          items:
            type: string
          example:
            - "api-1"
            - "api-2"
      required:
        - name
        - version

    UpdateApiProduct:
      type: object
      title: "UpdateApiProduct"
      description: Request body to update an API Product
      properties:
        name:
          type: string
          description: The API Product name
          minLength: 1
          maxLength: 255
          example: "My Updated API Product"
        description:
          type: string
          description: The API Product description
          example: "An updated bundle of public APIs"
        version:
          type: string
          description: The API Product version
          example: "1.0.1"
        apiIds:
          type: array
          description: |
            List of API IDs included in the product. 
            When provided in PUT request, this will REPLACE the entire list of APIs (not merge).
            APIs are managed as part of the API Product payload, similar to how groups are managed in APIs.
            To add or remove APIs, update the entire list via PUT.
          items:
            type: string
          example:
            - "api-1"
            - "api-2"
      required:
        - name
        - version

    ApiProduct:
      type: object
      title: "ApiProduct"
      description: API Product representation
      properties:
        id:
          type: string
          description: The API Product ID
          example: "api-product-123"
        environmentId:
          type: string
          description: The environment ID
          example: "DEFAULT"
        name:
          type: string
          description: The API Product name
          example: "My API Product"
        description:
          type: string
          description: The API Product description
          example: "A bundle of public APIs"
        version:
          type: string
          description: The API Product version
          example: "1.0.0"
        apiIds:
          type: array
          description: List of API IDs included in the product
          items:
            type: string
          example:
            - "api-1"
            - "api-2"
        createdAt:
          type: string
          format: date-time
          description: API Product creation date
          example: "2025-01-01T10:15:30Z"
        updatedAt:
          type: string
          format: date-time
          description: API Product last update date
          example: "2025-01-01T10:15:30Z"
        primaryOwner:
          $ref: '#/components/schemas/PrimaryOwner'
        deploymentState:
          $ref: '#/components/schemas/ApiProductDeploymentState'

    ApiProductDeploymentState:
      type: string
      description: Indicates whether the API Product is in sync with the latest deployment.
      enum:
        - DEPLOYED
        - NEED_REDEPLOY

    VerifyApiProductDeploymentResponse:
      type: object
      properties:
        ok:
          type: boolean
          description: Indicates whether the deployment can be done or not.
        reason:
          type: string
          description: An optional reason giving details about the result.

    PrimaryOwner:
      type: object
      description: The primary owner of the API Product
      properties:
        id:
          type: string
          description: Owner's uuid.
          example: 00f8c9e7-78fc-4907-b8c9-e778fc790750
        email:
          type: string
          description: Owner's email. Can be null if owner is a group.
        displayName:
          type: string
          description: Owner's name.
          example: John Doe
          minLength: 1
        type:
          $ref: "#/components/schemas/MembershipMemberType"

    MembershipMemberType:
      type: string
      description: The type of the member (USER or GROUP)
      enum:
        - USER
        - GROUP

    Error:
      type: object
      properties:
        httpStatus:
          type: integer
          format: int32
          description: The error code
          example: 400
        message:
          type: string
          description: The error message
          example: Bad request
        technicalCode:
          type: string
          description: A technical code to identify the error
          example: invalid.api.product.name
        parameters:
          type: object
          description: A map of parameters to be used in the error message
          additionalProperties:
            type: string
        details:
          type: array
          description: A list of details about the error
          items:
            type: object
            properties:
              message:
                type: string
                description: The error message
                example: Bad request
              location:
                type: string
                description: The json path of the field in error.
                example: verifyApiProduct.name
              invalidValue:
                description: The invalid value.

    BaseApiProductPlan:
      type: object
      properties:
        id:
          type: string
          description: Plan's uuid.
          example: 00f8c9e7-78fc-4907-b8c9-e778fc790750
        name:
          type: string
          description: Plan's name. Duplicate names can exists.
          example: My Api Product plan
        description:
          type: string
          description: Plan's description. A short description of your plan.
          example: I can use a hundred characters to describe this plan.
        apiId:
          type: string
          description: Id of the API Product owning the plan.
          example: 6c530064-0b2c-4004-9300-640b2ce0047b
        security:
          $ref: "#/components/schemas/PlanSecurity"
        mode:
          $ref: "#/components/schemas/PlanMode"
    PlanMode:
      type: string
      description: The behavioural mode of the Plan (Standard for classical plan, Push for subscription plan).
      example: STANDARD
      enum:
        - STANDARD
        - PUSH

    GenericApiProductPlan:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseApiProductPlan"
        - properties:
            characteristics:
              type: array
              items:
                type: string
            closedAt:
              type: string
              format: date-time
              description: The datetime when the plan was closed.
              example: 2023-05-25T12:40:46.184Z
            commentMessage:
              type: string
              description: A message from the API Product Publisher that is displayed to the consumer at subscription time.
              example: Explain why you want to subscribe.
            commentRequired:
              type: boolean
              description: A flag indicating if the consumer has to write a "consumer message" or if he/she can leave the field blank.
            createdAt:
              type: string
              format: date-time
              description: The last datetime when the plan was created.
              example: 2023-05-25T12:40:46.184Z
            crossId:
              type: string
              description: Plan's crossId. Identifies plan across environments.
              example: df83b2a4-cc3e-3f80-9f0d-c138c106c076

            description:
              type: string
              description: Plan's description. A short description of your plan.
              example: I can use a hundred characters to describe this plan.
            excludedGroups:
              type: array
              description: Groups of users which are not allowed to subscribe to this plan.
              example:
                - MY_GROUP1
                - MY_GROUP2
              items:
                type: string
            generalConditions:
              type: string
            order:
              type: integer
            publishedAt:
              type: string
              format: date-time
              description: The last datetime when the plan was published.
              example: 2023-05-25T12:40:46.184Z
            selectionRule:
              type: string
            status:
              $ref: "#/components/schemas/PlanStatus"
            tags:
              type: array
              description: The list of sharding tags associated with this plan.
              example:
                - public
                - private
              items:
                type: string

            updatedAt:
              type: string
              format: date-time
              description: The last datetime when the plan was updated.
              example: 2023-05-25T12:40:46.184Z
            validation:
              $ref: "#/components/schemas/ProductPlanValidation"


    ApiProductPlan:
      type: object
      title: "ProductPlan"
      allOf:
        - $ref: "#/components/schemas/GenericApiProductPlan"
    PlanSecurity:
      type: object
      properties:
        type:
          $ref: "#/components/schemas/PlanSecurityType"
        configuration:
          type: object
      required:
        - type

    PlanSecurityType:
      type: string
      description: Plan security type.
      example: KEY_LESS
      enum:
        - KEY_LESS
        - API_KEY
        - OAUTH2
        - JWT
        - MTLS

    PlanStatus:
      type: string
      description: Plan status.
      example: STAGING
      enum:
        - STAGING
        - PUBLISHED
        - DEPRECATED
        - CLOSED

    ProductPlanValidation:
      type: string
      description: Plan validation type.
      example: AUTO
      enum:
        - AUTO
        - MANUAL

    Pagination:
      description: Generic object to handle pagination data.
      type: object
      properties:
        page:
          type: integer
          description: The current page.
        perPage:
          type: integer
          description: The number of items requested per page.
        pageCount:
          type: integer
          description: The total number of pages.
        pageItemsCount:
          type: integer
          description: The number of items for the current page.
        totalCount:
          type: integer
          format: int64
          description: The total number of items.

    CreateApiProductPlan:
      type: object
      title: "CreateApiProductPlan"
      allOf:
        - $ref: "#/components/schemas/CreateGenericApiProductPlan"
        - properties:

            mode:
              $ref: "#/components/schemas/PlanMode"

    CreateGenericApiProductPlan:
      type: object
      properties:
        crossId:
          type: string
          description: Plan's crossId. Identifies plan across environments.
          example: df83b2a4-cc3e-3f80-9f0d-c138c106c076
        characteristics:
          type: array
          items:
            type: string
        commentMessage:
          type: string
          description: A message from the API Product Publisher that is displayed to the consumer at subscription time.
          example: Explain why you want to subscribe.
        commentRequired:
          type: boolean
          description: A flag indicating if the consumer has to write a "consumer message" or if he/she can leave the field blank.

        description:
          type: string
          description: Plan's description. A short description of your Plan.
          example: I can use a hundred characters to describe this plan.
        excludedGroups:
          type: array
          description: Groups of users which are not allowed to subscribe to this plan.
          example:
            - MY_GROUP1
            - MY_GROUP2
          items:
            type: string
        generalConditions:
          type: string
          description: This field contains the UUID of the documentation page that is used as General Conditions.
          example: 4e3de652-2301-48ba-bde6-522301e8ba3a
        name:
          type: string
          description: Plan's name. Duplicate names can exists.
          example: My Api Product plan
        order:
          type: integer
          description: Simple order that could be used by a front end to display plans in a certain order. To highlight a plan on the portal for instance.
          example: 0
        security:
          $ref: "#/components/schemas/PlanSecurity"
        selectionRule:
          type: string
          description: An optional EL expression that will be evaluated at request time to select this plan.
        tags:
          type: array
          description: The list of sharding tags associated with this plan.
          example:
            - public
            - private
          items:
            type: string
        validation:
          $ref: "#/components/schemas/ProductPlanValidation"


    UpdateGenericApiProductPlan:
      type: object
      properties:
        crossId:
          type: string
          description: Plan's crossId. Identifies plan across environments.
          example: df83b2a4-cc3e-3f80-9f0d-c138c106c076
        characteristics:
          type: array
          items:
            type: string
        commentMessage:
          type: string
          description: A message from the API Product Publisher that is displayed to the consumer at subscription time.
          example: Explain why you want to subscribe.
        commentRequired:
          type: boolean
          description: A flag indicating if the consumer has to write a "consumer message" or if he/she can leave the field blank.

        description:
          type: string
          description: Plan's description. A short description of your Plan.
          example: I can use a hundred characters to describe this plan.
        excludedGroups:
          type: array
          description: Groups of users which are not allowed to subscribe to this plan.
          example:
            - MY_GROUP1
            - MY_GROUP2
          items:
            type: string
        generalConditions:
          type: string
          description: This field contains the UUID of the documentation page that is used as General Conditions.
          example: 4e3de652-2301-48ba-bde6-522301e8ba3a
        name:
          type: string
          description: Plan's name. Duplicate names can exists.
          example: My Api Product plan
        order:
          type: integer
          description: Simple order that could be used by a front end to display plans in a certain order. To highlight a plan on the portal for instance.
          example: 0
        security:
          type: object
          properties:
            configuration:
              type: object
        validation:
          $ref: "#/components/schemas/ProductPlanValidation"


    Links:
      description: List of links for pagination
      properties:
        self:
          type: string
          description: Link to current resource
        first:
          type: string
          description: In a paginated response, link to the first page
        last:
          type: string
          description: In a paginated response, link to the last page
        previous:
          type: string
          description: In a paginated response, link to the previous page. Maybe null if current is the first page
        next:
          type: string
          description: In a paginated response, link to the next page. Maybe null if current is the last page

    SubscriptionStatus:
      type: string
      description: The status of the subscription manageable by the api publisher.
      example: ACCEPTED
      enum:
        - PENDING
        - REJECTED
        - ACCEPTED
        - CLOSED
        - PAUSED
        - RESUMED

    Subscription:
      type: object
      description: Subscription representation (same structure as API subscription)
      properties:
        id:
          type: string
          description: Subscription's uuid.
          example: 34f8c9e7-68fd-4922-b8c9-e778fc790777
    CreateSubscription:
      type: object
      description: Request to create a subscription (applicationId, planId, etc.)
      properties:
        applicationId:
          type: string
        planId:
          type: string
        customApiKey:
          type: string
        consumerConfiguration:
          type: object
        metadata:
          type: object
          additionalProperties:
            type: string
      required:
        - applicationId
        - planId
    UpdateSubscription:
      type: object
      description: Request to update a subscription
      properties:
        consumerConfiguration:
          type: object
        metadata:
          type: object
          additionalProperties:
            type: string
        startingAt:
          type: string
          format: date-time
        endingAt:
          type: string
          format: date-time
    AcceptSubscription:
      type: object
      description: Request to accept a subscription
      properties:
        startingAt:
          type: string
          format: date-time
        endingAt:
          type: string
          format: date-time
        reason:
          type: string
        customApiKey:
          type: string
    RejectSubscription:
      type: object
      description: Request to reject a subscription
      properties:
        reason:
          type: string
    VerifySubscription:
      type: object
      description: Request to verify that a subscription can be created with the given API Key and application.
      properties:
        applicationId:
          type: string
          description: The id of the application subscribing.
        apiKey:
          type: string
          description: 'The API Key that needs to be verified. Should not contain: ^ # % @ \\ / ; = ? | ~ , (space)'
          pattern: '^[^#%@/;=?|^~, \\]*$'
      required:
        - applicationId
        - apiKey
    VerifySubscriptionResponse:
      type: object
      description: Response indicating whether the subscription creation can be done.
      properties:
        ok:
          type: boolean
          description: Indicates whether the creation can be done or not.
        reason:
          type: string
          description: An optional reason giving details about the result.
    TransferSubscription:
      type: object
      description: Request to transfer a subscription to another plan
      properties:
        planId:
          type: string
          description: The plan identifier to transfer the subscription to.
    ApiKey:
      type: object
      description: API Key representation for a subscription
      properties:
        id:
          type: string
          description: The internal UUID of the API Key.
        key:
          type: string
          description: The API Key value to use to call the protected API.
        application:
          type: object
          description: The application owning this API Key.
          properties:
            id:
              type: string
        subscriptions:
          type: array
          description: The list of subscriptions using this API Key.
          items:
            type: object
            properties:
              id:
                type: string
        revoked:
          type: boolean
          description: Flag indicating that the API Key has been revoked.
        paused:
          type: boolean
          description: Flag indicating that the API Key has been paused.
        expired:
          type: boolean
          description: Flag indicating that the API Key has expired.
        expireAt:
          type: string
          format: date-time
          description: The datetime when the API Key expires.
        createdAt:
          type: string
          format: date-time
          description: The datetime when the API Key has been created.
        updatedAt:
          type: string
          format: date-time
          description: The datetime when the API Key has been updated.
        revokedAt:
          type: string
          format: date-time
          description: The datetime when the API Key has been revoked.
    UpdateApiKey:
      type: object
      description: Request to update an API Key
      properties:
        expireAt:
          type: string
          format: date-time
          description: The datetime when the API Key expires.
    RenewApiKey:
      type: object
      description: Request to renew an API Key
      properties:
        customApiKey:
          type: string
          description: Optional custom API Key when custom API Key support is enabled.
    SubscriptionApiKeysResponse:
      type: object
      description: Paged list of subscription API Keys
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ApiKey'
        pagination:
          $ref: '#/components/schemas/Pagination'
        links:
          $ref: '#/components/schemas/Links'
    SubscriptionsResponse:
      type: object
      description: Paged list of subscriptions
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Subscription'
        pagination:
          type: object
        links:
          type: object

  responses:
    VerifyApiProductResponse:
      description: Result of the API Product name verification
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/VerifyApiProductResponse"
          examples:
            success:
              summary: Name is available
              value:
                ok: true
            nameExists:
              summary: Name already exists
              value:
                ok: false
                reason: "An API Product with this name already exists"

    BadRequestError:
      description: Bad Request - Invalid request body or parameters
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            httpStatus: 400
            message: "Invalid request body"
            technicalCode: "invalid.request"
            details: []

    UnauthorizedError:
      description: Unauthorized - Authentication is required
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            httpStatus: 401
            message: "Unauthorized"
            technicalCode: "unauthorized"
            details: []

    ForbiddenError:
      description: Forbidden - User lacks required permissions
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            httpStatus: 403
            message: "Forbidden"
            technicalCode: "forbidden"
            details: []

    InternalServerError:
      description: Internal Server Error - Server error during verification
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            httpStatus: 500
            message: "Internal server error"
            technicalCode: "internal.error"
            details: []

    ApiProductPlansResponse:
      description: Page of API Product plans
      content:
        application/json:
          schema:
            title: "ApiProductPlansResponse"
            properties:
              data:
                description: List of API Product plans.
                type: array
                items:
                  $ref: "#/components/schemas/ApiProductPlan"
              pagination:
                $ref: "#/components/schemas/Pagination"
              links:
                $ref: "#/components/schemas/Links"

    Error:
      description: Generic error response
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
    CookieAuth:
      type: apiKey
      in: cookie
      name: Auth-Graviteeio-APIM